## Задание 9.1. Моделирование эрозии почв в пределах речного бассейна

**Объект исследования:** бассейн р. Упа, Тульская область, Россия
**Система координат:** EPSG:32637 - WGS 84 / UTM zone 37N
**Материалы для работы:** https://github.com/atsyplenkov/soil-erosion
**Необходимые программы:** `QGIS (> 3.2)`, `SAGA GIS (> 2.3.1)`. Ниже представлена процесс работы с версией QGIS 3.28.2 и SAGA GIS 7.8.2. Количество файлов, функций и опций на рисунках ниже и ваших компьютерах может отличаться. В этом задании использованы относительные пути, в виде `…/soil erosion/data/raster.tif` что означает, что файл `raster.tif` может лежать где угодно на вашем компьютере, главное в поддиректории `…/data/` и чтобы проект QGIS располагался в папке `…/soil erosion/`.

**Дано:**
1. Цифровая модель рельефа (ЦМР) разрешения 21.5м × 21.5м — `/data/input/upa_dem.tif`
2. Фрагмент векторной почвенной карты — `/data/input/upa_soils_k-factor.shp`
3. Векторный слой типов землепользования и подстилающего покрова — `/data/input/upa_lulc_c-factor.shp`
4. Среднемноголетнее значение эрозионного потенциала осадков (фактор R или ЭПО) для бассейна р. Упа равное `311` МДж·мм·ч−1·га−1·год−1

Перед началом работы убедиться, что **SAGA** **GIS** подключен к **QGIS**. Для этого в меню _Plugins →_ _Manage_ _and_ _Install_ _Plugins →_ _SAGA_ _GIS_ _Provider_ должен быть помечен как включенный. Запуск всех инструментов в QGIS осуществляется через Processing Toolbox, чтобы активировать это окно включите его в _Processing →_ _Processing_ _Toolbox_. В окошке поиска осуществляется поиск функций:
> ![](https://i.imgur.com/VfJCKBW.png)
> **Рисунок 84.** Пример поиска функции Raster Calculator в QGIS 3.28.2. 

## **Шаг 1.** **Построение карты фактора** **LS.**

Расчет топографического фактора эрозии почв, т.е. длины и крутизны склона LS, производится при помощи функции _LS-_factor_ _field_ _based_ на основе ЦМР, которая лежит в папке `/data/input/upa_dem.tif`. Введите в окне поиска _LS-factor_ _field_ _based_ как показано на рис. 84 или выберите его из списка в _Processing_ _Toolbox →_ _SAGA →_ _Terrain_ _Analysis –_ _Hydrology →_ _LS-factor_ _field_ _based_. Необходимо выбрать:

- входной растр ЦМР: пункт Elevation = `upa_dem`,
- способ расчета: пункт LS calculation = `[1] Desmet & Govers 1996`
- выходной растр: пункт LS Factor = `…/data/output/upa_ls.sdat`
- Остальные пункты оставляем по умолчанию

Функция LS-factor field based создаст много сопроводительных файлов, которые в данном задании не нужны. Вы можете их либо удалить, либо их не создавать. Для этого необходимо убрать галочки с пунктов: _Field_ _Statistics,_ _Upslope_ _Length_ _Factor,_ _Effective_ _Flow_ _Length,_ _Upslope_ _Slope,_ _Sediment_ _Balance_.

## Шаг 2. Построение карты эродируемости почв

В папке `…/data/input/` располагается файл `upa_soils_k-factor.shp`, который представляет собой фрагмент почвенной карты России из Единого государственного реестра почвенных ресурсов. В аттрибутивной таблице есть два столбца: `K_usle` (фактор эродируемости К) и `Type` (Тип почв). Необходимо построить растровый слой эродируемости почв на ее основе. Для этого запустите инструмент _Raster →_ _Conversion →_ _Rasterize (Vector to Raster)_ со следующими параметрами:
- Входной слой: пункт Input Layer = `upa_soils_k-factor`
- Столбец содержащий информацию о факторе К: Field to use for a burn-in value = `K_usle`
- Единицы измерения ячейки выходного растра: Output raster size units = `Georeferenced units`
- Размер ячейки выходного растра необходимо сделать таким же, как у ЦМР (`upa_dem`), т.е.:
	- Width/Horizontal resolution = `21.5`
	- Height/Vertical resolution = `21.5`
- Значения `NA`: пункт Assign a specified nodata value to output bands = `-99999`
- Границы растра необходимо сделать такими же, как у ЦМР (`upa_dem`): пункт _Output Extent → Calculate from layer → upa_dem_
- Выходной растр: пункт Rasterized =  `data/output/upa_k.sdat`

## Шаг 3. Построение растра фактора землепользования С

В папке `…/data/input/` располагается файл `upa_lulc_c-factor.shp`, в котором содержится информация о типах подстилающей поверхности (столбец `LULC`) и соответствующий им фактор `С` (см. табл. 48), взятый из литературных данных ([Benavidez et al., 2018](https://doi.org/10.5194/hess-22-6059-2018)). Для трансформации векторного слоя в растровый повторите **Шаг 2**. В качестве входного векторного слоя используйте `upa_lulc_c-factor`, столбец содержащий информацию о факторе С = `С`, выходной растр назовите `upa_c.sdat`. Остальные параметры оставьте те же, что и в **шаге 2**.

> **Таблица 48.** Характеристика типов подстилающей поверхности в бассейне р. Упа, построенная по данным полу-автоматического дешифрирования снимков Landsat-8

| LULC | Тип | C   |
| ---- | --- | --- |
| 1    |Водоемы     |   0  |
| 2    |Леса, кустарники|  0.003   |
| 3    |   Пашня  |     0.15|
| 4    |Луга     |     0.01|
| 5    | Населенные пункты вместе с отвалами, карьерами, участками широких автодорог и др. антропогенными объектами    |     0.03|

**Шаг 4. Построение карты потенциальной эрозии почв**

Следующий шаг состоит в реализации уравнения **9.2** в среде ГИС при помощи калькулятора растров. Он позволяет проводить математические операции с растровыми и числовыми типами данных. Таким образом, в одном уравнении возможно перемножить все растровые слои, сделанные в предыдущих шагах (`LS, K и C`) с эрозионным потенциалом осадков (`R`), представленным целочисленным значением.

Откройте калькулятор растров при помощи _Raster →_ _Raster_ _Calculator_. Введите следующую команду:

`"upa_c@1" * "upa_k@1" * "upa_ls@1" * 311
`
Параметр Output raster = `…data/results/upa_rusle.tif`. Убедитесь, что выходная система координат (СК) совпадает с СК проекта.

**Шаг 5. Анализ карты потенциальной эрозии почв**

Результатами расчета в **Шаге 4** является среднемноголетняя потенциальная эрозия почв в **т·га^−1·год^−1**. То есть в каждой ячейке размером **21.5×21.5** м содержится информация о потенциальном смыве измеряемом в **т·га^−1·год^−1**. Чтобы получить общие потери почв в **т·год^−1** со всего района исследований (в данном случае — водосбор р. Упа), необходимо пересчитать скорости на единицу площади. Для этого сумму значений всех ячеек растра `upa_rusle` необходимо умножить на площадь ячейки в м² (то есть квадрат от ширины/высоты ячейки в м, в нашем случае 21.5²) и поделить на 10 000, чтобы пересчитать м² в га.

Чтобы получить показатели описательной статистики растра эрозии почв (`usle_rusle`) используйте инструмент *Processing Toolbox → Raster Analysis → Raster layer statistics*. Выходной файл сохраните в директорию `/data/results/upa_usle`.html. Откройте его браузером или текстовым редактором. Для нас важны в данном случае два параметра:

- Сумма значений всех ячеек в т·га^−1·год^−1 — Sum: `7599421`
- Среднее значение в т·га^−1·год^−1 — Mean value: `2.61`

Чтобы посчитать суммарный среднемноголетний смыв почв (`Tot_erosion`) с  бассейна р. Упа в тоннах в год, перемножьте следующее:

`Tot_erosion = 7 599 421 * 21.5^2 / 10^4 = 351 283` **т/год**

ри этом средние темпы смыва (`Mean_erosion`) равны `2.61` **т·га^−1·год^−1**

>![](https://i.imgur.com/RPGWbYJ.png)
> **Рисунок 85.** Карта среднемноголетней потенциальной эрозии почв (т·га^−1·год^−1) на бассейн р. Упа